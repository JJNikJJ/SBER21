<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles/styles.css">
</head>
<body class="new-entry-page">
<div class="container">
    <header class="fixed-top d-flex justify-content-between align-items-center p-3 bg-light">
        <input type="text" class="form-control mr-2" placeholder="–ü–æ–∏—Å–∫...">
        <div>
            <span class="mr-3">üîî</span>
            <span class="menu-icon" onclick="toggleMenu()">‚ò∞</span>
        </div>
    </header>
    <nav class="fixed-sub-nav w-100 p-2">
        <div class="container d-flex justify-content-around">
            <button class="btn btn-link">–ü–æ–¥—Å–∫–∞–∑–∫–∏</button>
            <button class="btn btn-link">–û–±—É—á–µ–Ω–∏–µ</button>
            <button class="btn btn-link">–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã</button>
        </div>
    </nav>
    <div class="content mt-5 pt-5">
        <section class="new-entry mt-5 pt-3">
            <h2 class="mb-4">–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏</h2>
            <form id="entryForm">
                <div class="form-group">
                    <label for="entryType">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∑–∞–ø–∏—Å–∏</label>
                    <select class="form-control" id="entryType">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∑–∞–ø–∏—Å–∏...</option>
                        <option value="analysis">–ê–Ω–∞–ª–∏–∑—ã</option>
                        <option value="wellbeing">–û–±—â–µ–µ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ</option>
                    </select>
                </div>

                <div id="analysisFields" style="display: none;">
                    <div class="form-group">
                        <label for="analysisType">–¢–∏–ø –∞–Ω–∞–ª–∏–∑–∞</label>
                        <select class="form-control" id="analysisType">
                            <option value="totalCholesterol">–û–±—â–∏–π —Ö–æ–ª–µ—Å—Ç–µ—Ä–∏–Ω</option>
                            <option value="ldl">–õ–ü–ù–ü</option>
                            <option value="hdl">–õ–ü–í–ü</option>
                            <option value="triglycerides">–¢—Ä–∏–≥–ª–∏—Ü–µ—Ä–∏–¥—ã</option>
                            <option value="apoB">–ê–ø–æ–ª–∏–ø–æ–ø—Ä–æ—Ç–µ–∏–Ω B</option>
                            <option value="apoA1">–ê–ø–æ–ª–∏–ø–æ–ø—Ä–æ—Ç–µ–∏–Ω A-I</option>
                            <option value="lpA">–õ–∏–ø–æ–ø—Ä–æ—Ç–µ–∏–Ω(a)</option>
                            <option value="hsCRP">–í—ã—Å–æ–∫–æ—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π –°-—Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–π –±–µ–ª–æ–∫</option>
                            <option value="glucose">–ì–ª—é–∫–æ–∑–∞</option>
                            <option value="hbA1c">–ì–ª–∏–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥–µ–º–æ–≥–ª–æ–±–∏–Ω (HbA1c)</option>
                            <option value="waistCircumference">–û–∫—Ä—É–∂–Ω–æ—Å—Ç—å —Ç–∞–ª–∏–∏</option>
                            <option value="bloodPressure">–ê—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="analysisDate">–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞</label>
                        <input type="date" class="form-control" id="analysisDate">
                    </div>
                    <div class="form-group">
                        <label for="analysisValue">–ó–Ω–∞—á–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞</label>
                        <input type="number" step="0.1" class="form-control" id="analysisValue" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞">
                    </div>
                </div>

                <div id="wellbeingFields" style="display: none;">
                    <div class="form-group">
                        <label for="wellbeingDate">–î–∞—Ç–∞</label>
                        <input type="date" class="form-control" id="wellbeingDate">
                    </div>
                    <div class="form-group">
                        <label for="wellbeingStatus">–û–±—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è</label>
                        <input type="text" class="form-control" id="wellbeingStatus" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–±—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è">
                    </div>
                    <div class="form-group">
                        <label for="wellbeingDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea class="form-control" id="wellbeingDescription" rows="5" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ"></textarea>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary btn-block">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
            </form>
        </section>
    </div>
</div>

<nav id="burger-menu" class="burger-menu position-fixed p-3">
    <span class="close-icon" onclick="toggleMenu()">‚úñ</span>
    <ul class="list-unstyled">
        <li><a href="dashboard.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
        <li><a href="diary.html">–î–Ω–µ–≤–Ω–∏–∫</a></li>
        <li><a href="recommendations.html">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</a></li>
        <li><a href="consultations.html">–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏</a></li>
        <li><a href="support.html">–ü–æ–º–æ—â—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞</a></li>
        <li><a href="settings.html">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
    </ul>
</nav>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCjMYRohpvPHWhj9fthy3kaPX4N2Z1624Y",
        authDomain: "sberhealth21.firebaseapp.com",
        projectId: "sberhealth21",
        storageBucket: "sberhealth21.appspot.com",
        messagingSenderId: "322215357530",
        appId: "1:322215357530:web:ba065b1db10cf85ec6bc63",
        measurementId: "G-6XKSJYCWRZ"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function toggleMenu() {
        var menu = document.getElementById('burger-menu');
        menu.classList.toggle('open');
    }

    document.getElementById('entryType').addEventListener('change', function() {
        const analysisFields = document.getElementById('analysisFields');
        const wellbeingFields = document.getElementById('wellbeingFields');
        if (this.value === 'analysis') {
            analysisFields.style.display = 'block';
            wellbeingFields.style.display = 'none';
        } else if (this.value === 'wellbeing') {
            analysisFields.style.display = 'none';
            wellbeingFields.style.display = 'block';
        } else {
            analysisFields.style.display = 'none';
            wellbeingFields.style.display = 'none';
        }
    });

    document.getElementById('entryForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const user = firebase.auth().currentUser;
        if (user) {
            const entryType = document.getElementById('entryType').value;
            if (entryType === 'analysis') {
                const analysisType = document.getElementById('analysisType').value;
                const analysisDate = document.getElementById('analysisDate').value;
                const analysisValue = parseFloat(document.getElementById('analysisValue').value);

                const analysisData = {
                    type: analysisType,
                    date: analysisDate,
                    value: analysisValue
                };

                db.collection('users').doc(user.uid).update({
                    [`medicalData.${analysisType}`]: firebase.firestore.FieldValue.arrayUnion(analysisData)
                }).then(() => {
                    alert("–ê–Ω–∞–ª–∏–∑ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!");
                    window.location.href = "dashboard.html";
                }).catch(error => {
                    console.error("Error saving analysis data: ", error);
                    alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∞–Ω–∞–ª–∏–∑–∞: " + error.message);
                });
            } else if (entryType === 'wellbeing') {
                const wellbeingDate = document.getElementById('wellbeingDate').value;
                const wellbeingStatus = document.getElementById('wellbeingStatus').value;
                const wellbeingDescription = document.getElementById('wellbeingDescription').value;

                const wellbeingData = {
                    date: wellbeingDate,
                    status: wellbeingStatus,
                    description: wellbeingDescription
                };

                db.collection('users').doc(user.uid).update({
                    wellbeing: firebase.firestore.FieldValue.arrayUnion(wellbeingData)
                }).then(() => {
                    alert("–î–∞–Ω–Ω—ã–µ –æ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!");
                    window.location.href = "diary.html";
                }).catch(error => {
                    console.error("Error saving wellbeing data: ", error);
                    alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –æ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–∏: " + error.message);
                });
            }
        } else {
            console.log("User not authenticated");
            window.location.href = "login.html";
        }
    });
</script>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
